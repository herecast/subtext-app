{{#if showPreview}}
  {{news-editor-preview
  isOpen=showPreview
  news=news
  hasCaptionOrCredit=hasCaptionOrCredit
  closePreview=(action 'togglePreview')
  }}
{{/if}}

<div class='Container--noGutter'>
  <div class='row'>
    <div class='col-md-9'>
      <div class='NewsEditor-titleWrapper'>
        <h1 class='SectionHeader NewsEditor-title'>
          <span class='Section-text SectionHeader-text--secondaryBg'>{{title}}</span>
        </h1>
      </div>
    </div>
    <div class='col-md-3'>
      <div class='NewsEditor-autoSaveIndicator'>
        {{#if news.isDraft}}
          {{#unless (eq news.dirtyType 'created')}}
            <div>
              {{#auto-save-indicator model=news as |saveStatus|}}
                {{saveStatus}}
              {{/auto-save-indicator}}
            </div>
          {{/unless}}
        {{/if}}
      </div>
    </div>
  </div>
  <div class='row'>
    <div class='col-md-9'>
      <div class='NewsEditor-postBody u-dropShadow'>
        <div class="visible-xs visible-sm">
          {{#form-group error=errors.organization}}
            <label class='control-label'>Organization</label>
            {{#if news.isPublished}}
              <p>This content is owned by <i>{{news.organization.name}}</i>.</p>
            {{else}}
              {{organization-dropdown
                defaultName='Please choose an org'
                selection=(readonly chosenOrganization)
                organizations=filteredOrganizations
                class="with-border"
                updated=(action 'changeOrganization')
              }}
            {{/if}}
          {{/form-group}}
        </div>

        {{#form-group
        error=errors.title
        hideError=true
        }}
          <label class='control-label ContentForm-label--required' for="title">Title</label>
          {{form-error errors.title}}

          {{input
          id='title'
          placeholder='A short and informative title'
          class='form-control'
          value=news.title
          data-test-field='title'
          input=(action 'notifyChange')
          }}
        {{/form-group}}

        {{#form-group
        error=errors.subtitle
        hideError=true
        }}
          <label class='control-label' for="title">Subtitle</label>
          {{form-error errors.subtitle}}

          {{input
          id='subtitle'
          placeholder='A short and informative subtitle'
          class='form-control'
          value=news.subtitle
          data-test-field='subtitle'
          input=(action 'notifyChange')
          }}
        {{/form-group}}


        <div class="visible-xs visible-sm">
          {{#form-group error=errors.image}}
            <label class='control-label'>Featured Image</label>
            {{thumbnail-image-modal
              imageUrl=(mut news.featuredImageUrl)
              caption=(mut news.featuredImageCaption)
              title="Featured Image"
              saveImage=(action 'saveFeaturedImage')
              saveCaption=(action 'saveFeaturedImageCaption')
            }}
          {{/form-group}}
        </div>

        {{#form-group
        error=errors.content
        hideError=true
        }}
          <label class='control-label ContentForm-label--required' for="description">Content</label>
          {{form-error errors.content}}
          {{#summer-note
          content=(readonly news.content)
          editorHeight=editorHeight
          toolbar=(mut editorConfig)
          buttons=editorButtons
          modules=editorModules
          popover=editorPopover
          uploadImage=(action 'saveImage')
          notifyChange=(action 'saveContent')
          class='ContentForm-textArea'
          }}
            <div class='ContentText'>
              {{textarea
              id='content'
              placeholder='Enter your content here...'
              class='form-control'
              data-test-textarea='content'
              }}
            </div>
          {{/summer-note}}
        {{/form-group}}

        {{#form-group
        error=errors.author
        hideError=true
        }}
          <label>
            Author Override
              <span class='NewsEditor-toggle' {{action 'toggleAuthorOverride'}}>
                No
                {{#if authorOverrideEnabled}}
                  {{fa-icon 'toggle-on is-on' size='lg'}}
                {{else}}
                  {{fa-icon 'toggle-off' size='lg'}}
                {{/if}}
                Yes
              </span>
          </label>
          {{form-error errors.author}}
          <div class="NewsEditor-authorOverride">
            {{#if authorOverrideEnabled}}
              <div>
                {{input
                id='authorIsBlank'
                type='checkbox'
                checked=hasAuthorName
                change=(action 'toggleAuthorName')
                }}
                <span>
                  {{#if hasAuthorName}}
                    The author name indicated will be displayed. Uncheck the box to display no author.
                  {{else}}
                    No author will be displayed. Check the box to display a different author.
                  {{/if}}
                </span>
              </div>
              {{#if hasAuthorName}}
                <div>
                  {{input
                  id='authorName'
                  placeholder='Change author name to...'
                  class='form-control'
                  value=news.authorName
                  data-test-field='authorName'
                  input=(action 'notifyChange')
                  }}
                </div>
              {{/if}}
            {{else}}
              The current author will be set as <b>{{currentUser.name}}</b>. Do you want to override this?
            {{/if}}
          </div>
        {{/form-group}}

      </div>
    </div>
    <div class='col-md-3'>
      <div class='NewsEditor-sidebar Sidebar'>
        <div class='NewsEditor-sidebarWidget NewsEditor-sidebarWidget--publishSettings SidebarWidget'>
          <div class='PublishSettings'>
            <h2 class='SidebarWidget-header'><span class='SidebarWidget-text'>Publish Settings</span></h2>

            <div class='SidebarWidget-body' data-test-publish-status>
              <div class='PublishSettings-statusIndicator'>
                <p><b>Status: {{status}}</b></p>
              </div>

              {{#if news.isDraft}}
                {{#if isPickingScheduleDate}}
                  {{#form-group error=errors.publishedAt}}
                    <label class='control-label ContentForm-label--required' for="scheduled_date">
                      Publish Date
                    </label>
                    {{pick-a-date
                    date=(readonly selectedPubDate)
                    on-selected=(action (mut selectedPubDate))
                    placeholder="Pick a date"
                    class='form-control'
                    id="scheduled_date"
                    }}
                  {{/form-group}}
                  {{#form-group error=errors.publishedAt hideError=true}}
                    <label class='control-label ContentForm-label--required' for="scheduled_time">
                      Publish Time
                    </label>
                    {{pick-a-time
                    date=(readonly selectedPubDate)
                    on-selected=(action (mut selectedPubDate))
                    placeholder="Pick a time"
                    class='form-control'
                    id="scheduled_time"
                    }}
                  {{/form-group}}
                  <button {{action 'schedulePublish'}} class='btn btn-primary'>Confirm</button>
                  <button {{action 'cancelSchedulePublish'}} class='btn'>Cancel</button>
                {{else}}
                  <button {{action 'publish'}} class='btn btn-primary'>Publish Now</button>
                  <br/>
                  <button {{action 'choosePubDate'}} class='btn'>Schedule Publish</button>

                  <button {{action 'togglePreview'}} class='btn'>Preview Post</button>
                {{/if}}
              {{/if}}

              {{#if news.isScheduled}}
                {{#if (or news.hasUnpublishedChanges hasUnpublishedChanges)}}
                  <p>This post is set to go live on {{formatted-date news.publishedAt}}</p>
                  <div class="alert alert-warning" role="alert"><p>Your post has changes that will not be included when
                    your post goes live unless you save them.</p></div>
                  <button {{action 'publishChanges'}} class='btn btn-primary'>Save Changes</button>
                  <br/>
                  <button {{action 'togglePreview'}}
                      class='btn'>{{if news.hasUnpublishedChanges 'Preview Changes' 'Preview Post'}}</button>
                  <button {{action 'discardChanges'}} class='btn'>Discard changes</button>
                {{else}}
                  <p>This post is set to go live on {{formatted-date news.publishedAt}}
                    <a href='#' {{action 'unpublish'}} class='text-danger'><br/>Cancel Scheduled Publish</a>
                  </p>
                  <button class='btn btn-primary' {{action 'publish'}}>Publish Now</button>
                  <button {{action 'togglePreview'}}
                      class='btn'>{{if hasUnpublishedChanges 'Preview Changes' 'Preview Post'}}</button>
                {{/if}}
              {{/if}}

              {{#if news.isPublished}}
                Published {{formatted-date news.publishedAt}}.<br />
                {{#unless (or hasUnpublishedChanges isPublishing)}}
                  {{#if hasOrganization}}
                    {{link-to 'View it now in profile' 'profile.all.show' organizationId news.id}}<br />
                  {{/if}}
                  {{link-to 'View it now in feed' 'feed.show' news.id  (query-params type='stories')}}
                {{/unless}}

                {{#if (or news.hasUnpublishedChanges hasUnpublishedChanges)}}
                  <div class="alert alert-warning" role="alert"><p>Your post has changes that are not published.</p>
                  </div>
                  <button {{action 'publish'}} class='btn btn-primary'>Publish Changes</button>
                  <br/>
                  <button {{action 'discardChanges'}} class='btn'>Discard changes</button>

                  <button {{action 'togglePreview'}} class='btn'>Preview Changes</button>
                {{/if}}
              {{/if}}
            </div>
          </div>
        </div>
        <div class="hidden-xs hidden-sm">
          <div class='NewsEditor-sidebarWidget NewsEditor-sidebarWidget--organizationSettings SidebarWidget'>
            {{#if news.isPublished}}
              <h2 class='SidebarWidget-header'><span class='SidebarWidget-text'>Organization</span></h2>
              <div class='SidebarWidget-body'>
                <p>This content is owned by <i>{{news.organization.name}}</i>.</p>
              </div>
            {{else}}
              {{#form-group error=errors.organization}}
                <h2 class='SidebarWidget-header'><span class='SidebarWidget-text'>Organization</span></h2>
                <div class='SidebarWidget-body'>
                  <label class='h5 control-label ContentForm-label--required'>Content Owner</label>
                  {{organization-dropdown
                  defaultName='Please choose an org'
                  selection=(readonly chosenOrganization)
                  organizations=filteredOrganizations
                  class="with-border"
                  updated=(action 'changeOrganization')
                  }}
                </div>
              {{/form-group}}
            {{/if}}
          </div>

          <div class="NewsEditor-sidebarWidget NewsEditor-sidebarWidget--featuredImage SidebarWidget">
            {{#form-group}}
              <h2 class='SidebarWidget-header'><span class='SidebarWidget-text'>Featured Image</span></h2>
              <div class='SidebarWidget-body'>
                {{thumbnail-image-modal
                imageUrl=(mut news.featuredImageUrl)
                caption=(mut news.featuredImageCaption)
                title="Featured Image"
                saveImage=(action 'saveFeaturedImage')
                saveCaption=(action 'saveFeaturedImageCaption')
                }}
              </div>
            {{/form-group}}
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
