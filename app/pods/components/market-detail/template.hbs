<header class="DetailPage-navTop-container">

  {{#unless isPreview}}
    <div class="DetailPage-navTop clearfix">
      {{detail-page-close-link closeRoute=closeRoute closeLabel=closeLabel}}

      <div class="pull-right">
        {{social-share
        title=model.title
        sharedBy=session.userName
        model=model
        }}
      </div>
    </div>
  {{/unless}}

  {{#if activeImage}}
    {{header-image
      imageUrl=activeImage
      preserveAspectRatio=true
    }}
  {{/if}}
</header>

<div class="DetailPage-headerContainer">
  {{#if showThumbnails}}
    <div class="DetailPage-headerSection">
      {{#each model.images as |image|}}
        <img src="{{image.imageUrl}}" {{action 'chooseImage' image.imageUrl}} class="DetailPage-thumbnail"/>
      {{/each}}
    </div>
  {{/if}}

  <div class="DetailPage-headerSection">
    <h1 class="DetailPage-title h2" data-test-market-title>{{#if model.sold}}<span class='h3 u-bold u-tag'>SOLD!</span>{{/if}}&nbsp;&nbsp;{{model.title}}</h1>

    {{#if model.publishedAt}}
      <p>{{formatted-date model.publishedAt}}</p>
    {{/if}}
  </div>

    <div>
      {{#if hasClickedReplyButton}}
        <div class="DetailPage-headerSection">
          <div class="DetailPage-headerNav">
            {{#if model.contactEmail}}
              <div class="DetailPage-headerNavItem">
                <a href='mailto:{{model.contactEmail}}' target='_blank'>
                  <p>{{fa-icon 'reply' size=2}}</p>
                  Email
                </a>
              </div>
            {{/if}}

            {{#if model.contactPhone}}
              <div class="DetailPage-headerNavItem">
                <a href="tel:+1{{model.contactPhone}}">
                  <p>{{fa-icon 'phone' size=2}}</p>
                  <span class="visible-xs-inline">Call</span>
                  <span class="hidden-xs">{{formatted-phone model.contactPhone}}</span>
                </a>
              </div>
            {{/if}}

            {{#if model.address}}
              <div class="DetailPage-headerNavItem">
                <a href='{{model.directionsLink}}' target='_blank'>
                  <p>{{fa-icon 'map-marker' size=2}}</p>
                  Map
                </a>
              </div>
            {{/if}}
          </div>
        </div>
      {{else}}
        {{#unless model.sold}}
          {{market-reply-form
            post=(readonly model)
            clickReplyButton=(action 'clickReplyButton')
          }}
        {{/unless}}
      {{/if}}

      {{#if model.canEdit}}
        <div class="DetailPage-headerNavItem text-center">
          {{#link-to 'market.edit' model.id class='Button btn btn-default u-layoutPadB10'}}
            {{fa-icon 'pencil'}} Edit Listing
          {{/link-to}}
        </div>
      {{/if}}
    </div>
  </div>

{{#unless isPreview}}
  {{report-content-details
  contentId=model.contentId
  }}
{{/unless}}

<div class='DetailPage-sectionWrapper'>
  <div class="DetailPage-section DetailPage-content">
    {{#if model.price}}Price: {{model.price}}{{/if}}

    {{#if isPreview}}
      <span class="ContentText" data-test-market-content>{{{ model.content }}}</span>
    {{else}}
      {{#expandable-content customLessLabel='Read Less' customMoreLabel='Continue Reading'}}
        <span class="ContentText" data-test-market-content>{{{ model.content }}}</span>
      {{/expandable-content}}
    {{/if}}
  </div>
</div>

{{#unless isPreview}}
  {{#if featureFlags.market-detail-cta}}
    {{market-cta
      variation=featureFlags.market-detail-cta.options.variation
      imgUrl=featureFlags.market-detail-cta.options.image_url
    }}
  {{/if}}
{{/unless}}

{{#unless isPreview}}
  <div class='DetailPage-sectionWrapper'>
    <div class='AdBanner-wrapper AdBanner-wrapper--detail'>
      {{ad-banner
        contentModel=model
      }}
    </div>
  </div>
{{/unless}}

{{#unless isPreview}}
  <div class='DetailPage-sectionWrapper'>
    <div class="DetailPage-section DetailPage-similarContent">
      <h2 class='DetailPage-sectionTitle h2'>Suggested</h2>
      {{similar-content
      contentId=model.contentId
      limit=4
      }}
    </div>
  </div>
{{/unless}}
