{{to-elsewhere named='global-header' send=(component 'simple-header' title=organization.name avatarUrl=avatarUrl)}}

{{#if isLocationDependentProfile}}
  {{#unless session.isFastBoot}}
    {{to-elsewhere named="page-toolbar"
      send=(component "channel-filters"
        channel="index"
        radius=0
        onChooseMyStuffOnly=(action "onChooseMyStuffOnly")
        filterComponent=(component "header-location-control"
          location=locationForControls
          radiusDisabled=true
          onChooseLocation=(action 'onChooseLocation')
        )
      )
    }}
  {{/unless}}
{{/if}}

{{sticky-position name='profile/contact'}}

{{organization-profile-desktop-image imageUrl=organization.desktopImageUrl}}

{{#sticky-container position='profile/contact' enabled=stickyContainerEnabled as |sticky|}}

  {{#feed/feed-container noMargin=true}}
    {{outlet}}
  {{/feed/feed-container}}

  {{#if isAdmin}}
    {{cards/organization-toggle-admin-view
      displayAsAdminIfAllowed=(readonly displayAsAdminIfAllowed)
      onUpdate=(action 'updateAdminView')
    }}
  {{/if}}

  {{#cards/admin-card
    isAdmin=allowToEditHeader
    enableToggleButton=false
    organization=(readonly organization)
    editForm='form-partials/organization-profile-header'
    title='Profile Card'
    subtitle='This block will also appear in search results'
  }}
    {{cards/organization-profile-header organization=organization isProfileHeader=true}}
  {{/cards/admin-card}}

  {{#feed/feed-container}}

    {{#if showContactCard}}
      {{#cards/admin-card
        isAdmin=showAdminCards
        organization=(readonly organization)
        isActive=(readonly organization.contactCardActive)
        editForm='form-partials/organization-contact'
        updateCardStatus=(action 'toggleContactCard')
        title='Contact Details'
      }}
        {{#sticky.item maintainStickyItemSpace=false as |stickyContact| }}
          {{cards/organization-contact organization=organization flattenCard=stickyContact.isSticky}}
        {{/sticky.item}}
      {{/cards/admin-card}}
    {{/if}}

    {{#if showDescriptionHoursTabsCard}}
      {{cards/organization-about-hours-tabs organization=organization}}
    {{else}}
      {{#if showDescriptionCard}}
        {{#cards/admin-card
          isAdmin=showAdminCards
          organization=(readonly organization)
          isActive=(readonly organization.descriptionCardActive)
          editForm='form-partials/organization-description'
          updateCardStatus=(action 'toggleDescriptionCard')
          title='About'
        }}
          {{cards/organization-description organization=organization}}
        {{/cards/admin-card}}
      {{/if}}

      {{#if showHoursCard}}
        {{#cards/admin-card
          isAdmin=showAdminCards
          organization=(readonly organization)
          isActive=(readonly organization.hoursCardActive)
          editForm='form-partials/organization-hours'
          updateCardStatus=(action 'toggleHoursCard')
          title='Hours'
        }}
          {{cards/hours-card organization=organization}}
        {{/cards/admin-card}}
      {{/if}}
    {{/if}}

    {{#if showCalendarCard}}
      {{#cards/admin-card
        isAdmin=showAdminCards
        organization=(readonly organization)
        isActive=(readonly organization.calendarCardActive)
        editForm='form-partials/organization-calendar'
        updateCardStatus=(action 'toggleCalendarCard')
        title='Calendar View'
      }}
        {{#if showAdminCards}}Switching views only works when viewed by public{{/if}}
        {{cards/calendar-card
          organization=organization
          onTabChange=(action 'toggleFeedItemsView')
        }}
      {{/cards/admin-card}}
    {{/if}}

    {{#if showCreateContentCards}}
      {{cards/create-content-menu organization=organization}}
      {{cards/organization-your-content-tabs}}
      {{#x-card class="Feed-ProfileFeed-search-bar"}}
        {{search-input
          noBorder=true
          size='large'
          color='black'
          value=(readonly query)
          update=(action 'updateQuery')
          data-test-component='organization-content-query'
          isLoading=isLoading
          class="Feed-ProfileFeed-search-input"
        }}
        <div class="Feed-ProfileFeed-controls">
          {{fa-icon 'th-list' class=(if (not condensedView) 'active') click=(action 'toggleCondensedView') data-test-button='normal'}}
          {{fa-icon 'list' class=(if condensedView 'active') click=(action 'toggleCondensedView') data-test-button='condensed'}}
        </div>
      {{/x-card}}

    {{/if}}

    {{#if hasResults}}
      {{feed/profile-feed
        feedItems=visibleFeedItems
        show=(readonly show)
        organization=(readonly organization)
        canManage=(readonly isAdmin)
        displayAsPublic=(not showAdminCards)
        hideComments=(not showAdminCards)
        condensedView=condensedView
      }}

      {{#infinity-loader
        infinityModel=model
      }}
        {{#unless model.reachedInfinity}}
          {{fa-icon 'spinner' class="fa-pulse"}}
        {{/unless}}
      {{/infinity-loader}}
    {{else}}

      {{#x-card}}
        {{#card-body shortPadding=true}}
          {{#text-block}}
            {{#if hasPaidProfile}}
              {{#if (and isAdmin showAdminCards)}}
                <p>Take advantage of your page!</p>
                <p>As soon as you post to DailyUV, your content will begin appearing here.</p>
                <p>Just hit the blue "Create Content" button below.</p>
              {{else}}
                <p>{{organization.name}} hasn't posted any content yet.</p>
                <p>Contact them through one of the options above and let them know that you want to hear from them!</p>
              {{/if}}
            {{else}}
              {{#if (and isAdmin showAdminCards)}}
                <p>This is a basic DailyUV business page.</p>
                <p>You can edit hours and contact information.</p>
                <p>
                  If youâ€™d like to learn about enhancing your presence on DailyUV, please <a style="text-decoration:underline;" href={{mailtoHref}}>get in touch.</a>
                </p>
              {{else}}
                <p>
                  If you own or manage this business and want to edit your information or learn about enhancing this page, please <a style="text-decoration:underline;" href={{mailtoHref}}>get in touch.</a>
                </p>
              {{/if}}
            {{/if}}
          {{/text-block}}
        {{/card-body}}
      {{/x-card}}

    {{/if}}

  {{/feed/feed-container}}

{{/sticky-container}}
